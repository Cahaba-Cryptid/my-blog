create table Blogs (
id int not null auto_increment primary key,
title varchar(50) not null,
content varchar(1000) not null,
authorid int not null,
_created datetime default current_timestamp
);

create table Authors (
id int not null auto_increment primary key,
name varchar(50) not null,
email varchar(50) not null,
_created datetime default current_timestamp
);

create table Tags (
id int not null auto_increment primary key,
name varchar(50) null,
_created datetime default current_timestamp
);

create table BlogTags (
blogid int not null auto_increment primary key,
tagid int not null
);

create user 'blogadmin'@'localhost' identified by 'password123';

grant all privileges on blogs.Blog to 'blogadmin'@'localhost'; 

DROP PROCEDURE IF EXISTS spBlogTags

delimiter //
create procedure spBlogTags (blogid int)
begin
	SELECT BlogTags.*, Tags.name FROM BlogTags JOIN Tags ON BlogTags.tagid = Tags.id WHERE blogtags.blogid = blogid;
end //
delimiter ;

alter table Blogs
add constraint fk_authorid
foreign key (authorid)
references Authors(id);

insert into Authors(name, email)
values('Hayden', 'test@test.com');

insert into Authors(name, email)
values('Katie', 'test2@test.com');

insert into Authors(name, email)
values('Paul', 'test3@test.com');

insert into Blogs(authorid, title, content)
values (1, 'Blogging is fun!', 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean condimentum accumsan gravida. Pellentesque vitae nulla sit amet odio cursus maximus. Quisque ultrices eleifend urna, in.');

insert into Blogs(authorid, title, content)
values (2, 'Katie blogs!', 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean condimentum accumsan gravida. Pellentesque vitae nulla sit amet odio cursus maximus. Quisque ultrices eleifend urna, in.');

ALTER USER 'blogadmin'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password123';
flush privileges; 
grant all privileges on blogs.* to 'blogadmin'@'localhost';

insert into Blogs(authorid, title, content)
values(3, 'Paul Blogs More!', 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean condimentum accumsan gravida. Pellentesque vitae nulla sit amet odio cursus maximus. Quisque ultrices eleifend urna, in.');

alter table BlogTags
add constraint fk_blogtags
foreign key (tagid)
references Tags(id);

alter table BlogTags
add constraint fk_blogtagsblog
foreign key (blogid)
references Blogs(id);

INSERT INTO BlogTags (blogid, tagid)
values(3, 3);

INSERT INTO BlogTags(blogid, tagid)
VALUES(2, 4), (2, 1);

INSERT INTO BlogTags(blogid, tagid)
VALUES (6, 1),(6, 2),(6, 3),(6, 4);

CALL spBlogTags(6);

INSERT INTO Tags(name)
VALUES ("Work"), ("Home Life"), ("Liesure");








